!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).RelationalPouch=e()}}(function(){return function i(s,u,a){function c(n,e){if(!u[n]){if(!s[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(f)return f(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var o=u[n]={exports:{}};s[n][0].call(o.exports,function(e){var t=s[n][1][e];return c(t||e)},o,o.exports,i,s,u,a)}return u[n].exports}for(var f="function"==typeof require&&require,e=0;e<a.length;e++)c(a[e]);return c}({1:[function(Y,e,t){(function(e){"use strict";Y("lie");for(var n=Y("events"),t={},r=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],o=0;o<r.length;o++){var i=r[o];t["[object "+i+"]"]=i.toLowerCase()}var s=t.toString,u=t.hasOwnProperty;function a(e){return null===e?String(e):"object"==typeof e||"function"==typeof e?t[s.call(e)]||"object":typeof e}function v(e){if(!e||"object"!==a(e)||e.nodeType||null!==(t=e)&&t===t.window)return!1;var t,n;try{if(e.constructor&&!u.call(e,"constructor")&&!u.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(n in e);return void 0===n||u.call(e,n)}function y(e){return"function"===a(e)}var m=Array.isArray||function(e){return"array"===a(e)};function c(e,t,n){var r,o,i,s,u,a,c,f=t[0]||{},l=1,h=t.length,d=!1,p=/\d+/;for("boolean"==typeof f&&(d=f,f=t[1]||{},l=2),"object"==typeof f||y(f)||(f={}),h===l&&(f=this,--l);l<h;l++)if(null!=(r=t[l]))for(o in c=m(r),r)if(!(o in Object.prototype)){if(c&&!p.test(o))continue;if(i=f[o],f===(s=r[o]))continue;d&&s&&(v(s)||(u=m(s)))?(u?(u=!1,a=i&&m(i)?i:[]):a=i&&v(i)?i:{},e.push({args:[d,a,s],result:{container:f,key:o}})):void 0!==s&&(m(r)&&y(s)||(f[o]=s))}n.container[n.key]=f}var p=function(){for(var e=[],t=-1,n=arguments.length,r=new Array(n);++t<n;)r[t]=arguments[t];var o,i={};for(e.push({args:r,result:{container:i,key:"key"}});o=e.pop();)c(e,o.args,o.result);return i.key};var g={};function f(){this.store={}}function l(){this.store=new f}g.Map=f,g.Set=l,f.prototype.mangle=function(e){if("string"!=typeof e)throw new TypeError("key must be a string but Got "+e);return"$"+e},f.prototype.unmangle=function(e){return e.substring(1)},f.prototype.get=function(e){var t=this.mangle(e);return t in this.store?this.store[t]:void 0},f.prototype.set=function(e,t){var n=this.mangle(e);return this.store[n]=t,!0},f.prototype.has=function(e){return this.mangle(e)in this.store},f.prototype.delete=function(e){var t=this.mangle(e);return t in this.store&&(delete this.store[t],!0)},f.prototype.forEach=function(n){var r=this;Object.keys(r.store).forEach(function(e){var t=r.store[e];e=r.unmangle(e),n(t,e)})},l.prototype.add=function(e){return this.store.set(e,!0)},l.prototype.has=function(e){return this.store.has(e)},l.prototype.delete=function(e){return this.store.delete(e)};var _="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");function w(e){return 0|Math.random()*e}var b=function(e,t,n){return 0===e.length?e:t?(n||e.sort(t),function(e,t){for(var n=1,r=e.length,o=e[0],i=e[0],s=1;s<r;++s)if(i=o,t(o=e[s],i)){if(s===n){n++;continue}e[n++]=o}return e.length=n,e}(e,t)):(n||e.sort(),function(e){for(var t=1,n=e.length,r=e[0],o=e[0],i=1;i<n;++i,o=r)if(o=r,(r=e[i])!==o){if(i===t){t++;continue}e[t++]=r}return e.length=t,e}(e))},E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var h=16,d="0",j="1",k="2",L="3";function O(e,t){var n=e.replace("_","")+"_";if("number"==typeof t){for(t=t.toString();t.length<h;)t="0"+t;n+=j+"_"+t}else void 0===t?n+=d:"object"===(void 0===t?"undefined":E(t))?n+=L:n+=k+"_"+t;return n}function T(e){var t=e.indexOf("_"),n=e.charAt(t+1),r=e.substring(t+3);return n===j?parseInt(r,10):r}var x={setSchema:function(i){var u=this,s=new g.Map;function a(i,s){var e={};(s=p(!0,{},s)).rev&&(e._rev=s.rev,delete s.rev),s.attachments&&(e._attachments=s.attachments,delete s.attachments);var t=s.id||function(e,t){t=t||_.length;var n="",r=-1;if(e){for(;++r<e;)n+=_[w(t)];return n}for(;++r<36;)switch(r){case 8:case 13:case 18:case 23:n+="-";break;case 19:n+=_[3&w(16)|8];break;default:n+=_[w(16)]}return n}();return delete s.id,e._id=O(i.documentType,t),i.relations&&Object.keys(i.relations).forEach(function(e){var t=i.relations[e],n=Object.keys(t)[0];if("belongsTo"===n)s[e]&&void 0!==s[e].id&&(s[e]=s[e].id);else{var r=t[n];if(r.options&&r.options.queryInverse)return void delete s[e];if(s[e]){var o=s[e].map(function(e){return e&&void 0!==e.id?e.id:e});s[e]=o}else s[e]=[]}}),e.data=s,e}function l(e){if(!s.has(e))throw t="unknown type: "+JSON.stringify(e),(n=new Error(t)).status=400,n;var t,n;return s.get(e)}function h(e,t,n){var r=l(e),o={include_docs:!0};return null==t?(o.startkey=O(r.documentType),o.endkey=O(r.documentType,{})):Array.isArray(t)?o.keys=t.map(function(e){return O(r.documentType,e)}):"object"===(void 0===t?"undefined":E(t))?(void 0===t.startkey||null===t.startkey?o.startkey=O(r.documentType):o.startkey=O(r.documentType,t.startkey),void 0===t.endkey||null===t.endkey?o.endkey=O(r.documentType,{}):o.endkey=O(r.documentType,t.endkey),void 0!==t.limit&&null!==t.limit&&(o.limit=t.limit),void 0!==t.skip&&null!==t.skip&&(o.skip=t.skip)):o.key=O(r.documentType,t),u.allDocs(o).then(function(e,t,n){return c(e,t,n.rows.filter(function(e){return e.doc&&!e.value.deleted}).map(function(e){return e.doc}))}.bind(u,e,n))}function c(r,c,t){var f=l(r);return c.has(r)||c.set(r,new g.Map),Promise.resolve().then(function(){var e=t.map(function(e){var t,n,u=((n=(t=e).data).id=T(t._id),n.rev=t._rev,t._attachments&&(n.attachments=t._attachments),n);c.get(r).set(JSON.stringify(u.id),u);var a=[];return Object.keys(f.relations||{}).forEach(function(e){var t=f.relations[e],n=Object.keys(t)[0],r=t[n],o={};if("string"!=typeof r){if((o=r.options||{}).async)return;o.queryInverse&&delete u[e],r=r.type}if("belongsTo"===n){var i=u[e];void 0!==i&&a.push(Promise.resolve().then(function(){if(!c.has(r)||!c.get(r).has(JSON.stringify(i)))return{relatedType:r,relatedIds:[i]}}))}else{if(o.queryInverse)return void a.push(d(r,o.queryInverse,u.id,c).then(function(){}));var s=p(!0,[],u[e]);void 0!==s&&s.length&&a.push(Promise.resolve().then(function(){for(var e=s.length-1;0<=e;e--){var t=s[e];c.has(r)&&c.get(r).has(JSON.stringify(t))&&delete s[e]}if((s=s.filter(function(e){return void 0!==e})).length)return{relatedType:r,relatedIds:s}}))}}),Promise.all(a)});return Promise.all(e)}).then(function(e){var n,r,o,i={};return e.forEach(function(e){e.forEach(function(e){e&&(i[e.relatedType]=(i[e.relatedType]||[]).concat(e.relatedIds))})}),(n=Object.keys(i).map(function(e){var t=b(i[e]);return function(){return h(e,t,c)}}),r=Promise.resolve(),o=new Array(n.length),n.forEach(function(e,t){r=r.then(n[t]).then(function(e){o[t]=e})}),r.then(function(){return o})).then(function(){var o={};return c.forEach(function(e,t){var n=l(t),r=o[n.plural]=[];e.forEach(function(e){r.push(e)})}),o})})}function d(t,e,n,r){var o={_id:{$gt:f({type:t}),$lt:f({type:t,id:{}})}};return o["data."+e]=n,u.find({selector:o}).then(function(e){return c(t,r,e.docs)})}function f(e){var t=e.type,n=s.get(t);return n&&(t=n.documentType),O(t,e.id)}i.forEach(function(e){s.set(e.singular,e),s.set(e.plural,e)}),i.forEach(function(e){e.documentType=e.documentType||e.singular}),i.forEach(function(o){if(o.relations){if(!Object.keys(o.relations).length)throw new Error("Invalid relations for: "+o);Object.keys(o.relations).forEach(function(e){var t=o.relations[e];if(1!==Object.keys(t).length)throw new Error("Invalid relationship definition for: "+e);var n=Object.keys(t)[0],r=t[n];if("string"!=typeof r&&(r=r.type),!s.get(r))throw new Error("Unknown entity type: "+r);if("belongsTo"!==n&&"hasMany"!==n)throw new Error("Invalid relationship type for "+e+": "+n)})}}),u.rel={save:function(t,o){return Promise.resolve().then(function(){return n=o,r=l(t),Promise.resolve().then(function(){return e=a(r,n),u.put(e)}).then(function(e){var t={};return t[r.plural]=[p(!0,n,{id:T(e.id),rev:e.rev})],t});var n,e,r})},find:function(e,t){return Promise.resolve().then(function(){return h(l(e).singular,t,new g.Map)})},findHasMany:function(e,t,n){return d(e,t,n,new g.Map)},del:function(r,o){return Promise.resolve().then(function(){return e=o,n=l(r),Promise.resolve().then(function(){return t={_id:(t=a(n,e))._id,_rev:t._rev,_deleted:!0},u.put(t)}).then(function(){return{deleted:!0}});var e,t,n})},getAttachment:function(e,t,n,r){return r=r||{},Promise.resolve().then(function(){return u.getAttachment(O(e,t),n,r)})},putAttachment:function(e,n,t,r,o){var i=O(e,n.id),s=l(e);return Promise.resolve().then(function(){return u.putAttachment(i,t,n.rev,r,o)}).then(function(e){var t={};return t[s.plural]=[p(!0,n,{id:T(e.id),rev:e.rev})],t})},removeAttachment:function(e,n,t){var r=O(e,n.id),o=l(e);return Promise.resolve().then(function(){return u.removeAttachment(r,t,n.rev)}).then(function(e){var t={};return t[o.plural]=[p(!0,n,{id:T(e.id),rev:e.rev})],t})},parseDocID:function(e){var t=e.indexOf("_"),n=e.substring(0,t),r=T(e);if(!s.get(n)){var o=i.filter(function(e){return e.documentType===n});0<o.length&&(n=o[0].singular)}return{type:n,id:r}},makeDocID:f,parseRelDocs:function(e,t){return c(e,new g.Map,t)},isDeleted:function(e,t){var n=l(e);return u.get(O(n.documentType,t)).then(function(e){return!!e._deleted}).catch(function(e){return"deleted"===e.reason||null})}}}};function q(e){return"$"+e}function S(){this._store={}}function A(e){if(this._store=new S,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}S.prototype.get=function(e){var t=q(e);return this._store[t]},S.prototype.set=function(e,t){var n=q(e);return this._store[n]=t,!0},S.prototype.has=function(e){return q(e)in this._store},S.prototype.delete=function(e){var t=q(e),n=t in this._store;return delete this._store[t],n},S.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var o=t[n];e(this._store[o],o=o.substring(1))}},Object.defineProperty(S.prototype,"size",{get:function(){return Object.keys(this._store).length}}),A.prototype.add=function(e){return this._store.set(e,!0)},A.prototype.has=function(e){return this._store.has(e)},A.prototype.forEach=function(n){this._store.forEach(function(e,t){n(t)})},Object.defineProperty(A.prototype,"size",{get:function(){return this._store.size}});var M="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};function C(e,t){return e(t={exports:{}},t.exports),t.exports}var D,P,N=M.MutationObserver||M.WebKitMutationObserver;if(N){var I=0,R=new N(B),F=M.document.createTextNode("");R.observe(F,{characterData:!0}),D=function(){F.data=I=++I%2}}else if(M.setImmediate||void 0===M.MessageChannel)D="document"in M&&"onreadystatechange"in M.document.createElement("script")?function(){var e=M.document.createElement("script");e.onreadystatechange=function(){B(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},M.document.documentElement.appendChild(e)}:function(){setTimeout(B,0)};else{var J=new M.MessageChannel;J.port1.onmessage=B,D=function(){J.port2.postMessage(0)}}var U=[];function B(){var e,t;P=!0;for(var n=U.length;n;){for(t=U,U=[],e=-1;++e<n;)t[e]();n=U.length}P=!1}var z=function(e){1!==U.push(e)||P||D()};var W=C(function(e){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}});function V(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}W(V,Error),V.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new V(401,"unauthorized","Name or password is incorrect."),new V(400,"bad_request","Missing JSON list of 'docs'"),new V(404,"not_found","missing"),new V(409,"conflict","Document update conflict"),new V(400,"bad_request","_id field must contain a string"),new V(412,"missing_id","_id is required for puts"),new V(400,"bad_request","Only reserved document ids may start with underscore."),new V(412,"precondition_failed","Database not open"),new V(500,"unknown_error","Database encountered an unknown error"),new V(500,"badarg","Some query argument is invalid"),new V(400,"invalid_request","Request was invalid"),new V(400,"query_parse_error","Some query parameter is invalid"),new V(500,"doc_validation","Bad special document member"),new V(400,"bad_request","Something wrong with the request"),new V(400,"bad_request","Document must be a JSON object"),new V(404,"not_found","Database not found"),new V(500,"indexed_db_went_bad","unknown"),new V(500,"web_sql_went_bad","unknown"),new V(500,"levelDB_went_went_bad","unknown"),new V(403,"forbidden","Forbidden by design doc validate_doc_update function"),new V(400,"bad_request","Invalid rev format"),new V(412,"file_exists","The database could not be created, the file already exists."),new V(412,"missing_stub","A pre-existing attachment stub wasn't found"),new V(413,"invalid_url","Provided URL is invalid"),C(function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}});for(var $=[],G=0;G<256;++G)$[G]=(G+256).toString(16).substr(1);var K;Function.prototype.toString.call(Object);function H(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}if(H())K=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),K=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){K=!1}function Q(){return K}function X(){var t;n.EventEmitter.call(this),this._listeners={},t=this,H()?chrome.storage.onChanged.addListener(function(e){null!=e.db_name&&t.emit(e.dbName.newValue)}):Q()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(e){t.emit(e.key)}):window.attachEvent("storage",function(e){t.emit(e.key)}))}W(X,n.EventEmitter),X.prototype.addListener=function(e,t,n,r){if(!this._listeners[t]){var o=this,i=!1;this._listeners[t]=s,this.on(e,s)}function s(){if(o._listeners[t])if(i)i="waiting";else{i=!0;var e=function(e,t){for(var n={},r=0,o=t.length;r<o;r++){var i=t[r];i in e&&(n[i]=e[i])}return n}(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);n.changes(e).on("change",function(e){e.seq>r.since&&!r.cancelled&&(r.since=e.seq,r.onChange(e))}).on("complete",function(){"waiting"===i&&z(s),i=!1}).on("error",function(){i=!1})}}},X.prototype.removeListener=function(e,t){t in this._listeners&&(n.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},X.prototype.notifyLocalWindows=function(e){H()?chrome.storage.local.set({dbName:e}):Q()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},X.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)},"undefined"==typeof PouchDB?function(e){if("undefined"!=typeof console&&"function"==typeof console[e]){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}("error",'pouchdb-find plugin error: Cannot find global "PouchDB" object! Did you remember to include pouchdb.js?'):PouchDB.plugin(x)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{events:2,lie:4}],2:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function c(e){return"object"==typeof e&&null!==e}function f(e){return void 0===e}((t.exports=r).EventEmitter=r).prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,o,i,s;if(this._events||(this._events={}),"error"===e&&(!this._events.error||c(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(f(n=this._events[e]))return!1;if(a(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(c(n))for(o=Array.prototype.slice.call(arguments,1),r=(s=n.slice()).length,i=0;i<r;i++)s[i].apply(this,o);return!0},r.prototype.on=r.prototype.addListener=function(e,t){var n;if(!a(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?c(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,c(this._events[e])&&!this._events[e].warned&&(n=f(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&0<n&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.once=function(e,t){if(!a(t))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var n,r,o,i;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,r=-1,n===t||a(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(c(n)){for(i=o;0<i--;)if(n[i]===t||n[i].listener&&n[i].listener===t){r=i;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(a(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(a(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],3:[function(e,f,t){(function(t){"use strict";var n,r,e=t.MutationObserver||t.WebKitMutationObserver;if(e){var o=0,i=new e(c),s=t.document.createTextNode("");i.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)};else{var u=new t.MessageChannel;u.port1.onmessage=c,n=function(){u.port2.postMessage(0)}}var a=[];function c(){var e,t;r=!0;for(var n=a.length;n;){for(t=a,a=[],e=-1;++e<n;)t[e]();n=a.length}r=!1}f.exports=function(e){1!==a.push(e)||r||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t,n){"use strict";var o=e("immediate");function c(){}var f={},i=["REJECTED"],s=["FULFILLED"],r=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=r,this.queue=[],this.outcome=void 0,e!==c&&d(this,e)}function a(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function l(t,n,r){o(function(){var e;try{e=n(r)}catch(e){return f.reject(t,e)}e===t?f.reject(t,new TypeError("Cannot resolve promise with itself")):f.resolve(t,e)})}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function d(t,e){var n=!1;function r(e){n||(n=!0,f.reject(t,e))}function o(e){n||(n=!0,f.resolve(t,e))}var i=p(function(){e(o,r)});"error"===i.status&&r(i.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=u).prototype.finally=function(t){if("function"!=typeof t)return this;var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})})},u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===i)return this;var n=new this.constructor(c);this.state!==r?l(n,this.state===s?e:t,this.outcome):this.queue.push(new a(n,e,t));return n},a.prototype.callFulfilled=function(e){f.resolve(this.promise,e)},a.prototype.otherCallFulfilled=function(e){l(this.promise,this.onFulfilled,e)},a.prototype.callRejected=function(e){f.reject(this.promise,e)},a.prototype.otherCallRejected=function(e){l(this.promise,this.onRejected,e)},f.resolve=function(e,t){var n=p(h,t);if("error"===n.status)return f.reject(e,n.value);var r=n.value;if(r)d(e,r);else{e.state=s,e.outcome=t;for(var o=-1,i=e.queue.length;++o<i;)e.queue[o].callFulfilled(t)}return e},f.reject=function(e,t){e.state=i,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},u.resolve=function(e){if(e instanceof this)return e;return f.resolve(new this(c),e)},u.reject=function(e){var t=new this(c);return f.reject(t,e)},u.all=function(e){var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,o=!1;if(!r)return this.resolve([]);var i=new Array(r),s=0,t=-1,u=new this(c);for(;++t<r;)a(e[t],t);return u;function a(e,t){n.resolve(e).then(function(e){i[t]=e,++s!==r||o||(o=!0,f.resolve(u,i))},function(e){o||(o=!0,f.reject(u,e))})}},u.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var o=-1,i=new this(c);for(;++o<n;)s=e[o],t.resolve(s).then(function(e){r||(r=!0,f.resolve(i,e))},function(e){r||(r=!0,f.reject(i,e))});var s;return i}},{immediate:3}]},{},[1])(1)});
